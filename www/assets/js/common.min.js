let Fn={},Evt={},getGeoLocation=($(()=>{document.addEventListener("touchstart",function(e){1<e.touches.length&&e.preventDefault()},{passive:!1});let s=0;document.addEventListener("touchend",function(e){var t=(new Date).getTime();t-s<=300&&(e.preventDefault(),document.body.style.transform="scale(1)",document.body.style.transformOrigin="0 0"),s=t},{passive:!1})}),Fn.doContDown=(e,n,r)=>{let l;var t=()=>{var t=Date.now(),t=e-t;if(t<=0)n.text("00:00:00"),l&&clearInterval(l),r&&r();else{var s=Math.floor(t/864e5),a=Math.floor(t/36e5%24),o=Math.floor(t/6e4%60),t=Math.floor(t/1e3%60);let e="";1<s?e+=s+"DAYS ":1===s&&(e+=s+"DAY "),e+=`${a.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}:`+t.toString().padStart(2,"0"),n.text(e)}};return t(),l=setInterval(t,1e3)},Evt.press=window.PointerEvent?"pointerdown":"ontouchstart"in window?"touchstart":"mousedown",Evt.release=window.PointerEvent?"pointerup":"ontouchstart"in window?"touchend":"mouseup",Fn.formatDistanceKm=(e=0)=>{let t=Number(e);return Number.isFinite(t)?(t=Math.abs(t)<1e-9?0:t)<1?Math.max(0,Math.round(1e3*t))+"m":Math.round(10*t)/10+"km":"---"},async(e=5,t=10)=>{let s=0,a={error_message:"現在地を取得できませんでした"};for(;s<e;)try{if((a=await new Promise((t,s)=>{navigator.geolocation.getCurrentPosition(e=>{t({lat:e.coords.latitude,lng:e.coords.longitude,accuracy:e.coords.accuracy})},e=>{switch(e.code){case e.PERMISSION_DENIED:s("位置情報のアクセスが拒否されました。");break;case e.POSITION_UNAVAILABLE:s("位置情報が利用できません。");break;case e.TIMEOUT:s("位置情報の取得がタイムアウトしました。");break;default:s("位置情報の取得に失敗しました。")}},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})})).accuracy<=t)return a;s++}catch(e){return a||{error_message:e}}return a}),getParam=e=>{e=new URLSearchParams(location.search).get(e);return e?decodeURIComponent(e):""},MAP=(Fn.getSearchKeywords=(e="")=>"string"!=typeof e?[]:e.normalize("NFKC").trim().split(/\s+/).filter(Boolean),Fn.getYmdJa=(e,t="ymd")=>{var s=new Date(e);switch(t){case"d":formatted=s.getDate()+"日";break;case"md":formatted=`${s.getMonth()+1}月${s.getDate()}日`;break;default:formatted=`${s.getFullYear()}年${s.getMonth()+1}月${s.getDate()}日`}return formatted},Fn.isPastDate=(e,t,s=!1)=>{"today"===t&&(t=null);let a=(e="today"===e?null:e)?new Date(e.replace(/-/g,"/")):new Date,o=t?new Date(t.replace(/-/g,"/")):new Date;return a=a.setHours(0,0,0,0),o=o.setHours(0,0,0,0),s?a<=o:a<o},Fn.loadJson=async e=>{try{var t=await fetch(e);if(t.ok)return await t.json();throw new Error("HTTPエラー: "+t.status)}catch(e){return console.error("JSON取得失敗:",e),null}},Fn.loadJsonMultiple=async e=>await Promise.all(e.map(e=>Fn.loadJson(e))),{}),IS_LOCALSTORAGE=(MAP.markers=[],MAP.z_index=0,MAP.createMarker=({map:e,id:t,lat:s,lng:a,z_index:o,content:n,func:r})=>{e=new MAP.advaned_marker({map:e,position:{lat:s,lng:a},zIndex:o,content:n});e.addListener("click",()=>{r&&r(t)}),e._meta={id:t,lat:s,lng:a,z_index:o},MAP.markers.push({id:t,marker:e})},MAP.showMarker=t=>{var e=MAP.markers.find(e=>e.id===+t);e&&(e.marker.map=MAP.gmap)},MAP.showAllMarkers=()=>{MAP.markers.forEach(e=>{e.marker.map=MAP.gmap})},MAP.hideMarker=t=>{var e=MAP.markers.find(e=>e.id===+t);e&&(e.marker.map=null)},MAP.hideAllMarkers=()=>{MAP.markers.forEach(e=>{e.marker.map=null})},MAP.removeMarker=t=>{var e=MAP.markers.findIndex(e=>e.id===+t);e&&(MAP.markers[e].marker.map=null,MAP.markers.splice(e,1))},MAP.removeAllMarkers=()=>{MAP.hideAllMarkers(),MAP.markers=[]},MAP.animateMarker=t=>{var e,s=MAP.markers.find(e=>e.id===+t);s&&(e=(s=s.marker).content,MAP.z_index++,s.zIndex=MAP.z_index,e.classList.remove("maps-marker-pop"),e.offsetWidth,e.classList.add("maps-marker-pop"))},MAP.removeClassMarker=(t,e)=>{var s=MAP.markers.find(e=>e.id===+t);s&&s.marker.content.classList.add(e)},MAP.removeClassMarker=(t,e)=>{var s=MAP.markers.find(e=>e.id===+t);s&&s.marker.content.classList.remove(e)},MAP.addClassAllMarkers=t=>{MAP.markers.forEach(e=>{e.marker.content.classList.add(t)})},MAP.removeClassAllMarkers=t=>{MAP.markers.forEach(e=>{e.marker.content.classList.remove(t)})},MAP.getCenter=()=>{var e=MAP.gmap.getCenter();return{lat:e.lat(),lng:e.lng()}},MAP.panTo=(e,t)=>{e=MAP.normalizeLatLng(e,t);e&&MAP.gmap.panTo(e)},MAP.getCenterAfterChanged=t=>{MAP.gmap.addListener("idle",()=>{var e=MAP.getCenter();t(e.lat,e.lng)})},MAP.getAddressFromLatLng=(t,s)=>new Promise((a,e)=>{(new google.maps.Geocoder).geocode({location:{lat:t,lng:s}},(t,s)=>{if("OK"===s&&t[0]){let e=t[0].formatted_address;e.startsWith("日本")&&(e=(e=(e=(e=(e=e.replace(/^日本、?/,"")).replace(/〒\d{3}-\d{4}\s*/,"")).split(/[ー−-]/)[0]).trim()).replace(/[０-９]/g,e=>String.fromCharCode(e.charCodeAt(0)-65248))),a({status:s,str:e})}else e({status:s})})}),MAP.normalizeLatLng=(e,t)=>{e=Number(e),t=Number(t);return!Number.isFinite(e)||!Number.isFinite(t)||e<-90||90<e||t<-180||180<t?null:{lat:e,lng:t}},Fn.mapGetDistance=(e,t,s,a)=>{var o=e=>e*Math.PI/180,n=o(s-e),a=o(a-t),t=Math.sin(n/2)*Math.sin(n/2)+Math.cos(o(e))*Math.cos(o(s))*Math.sin(a/2)*Math.sin(a/2);return 6371*(2*Math.atan2(Math.sqrt(t),Math.sqrt(1-t)))},Fn.matchByKeywords=(e="",t=[],s="AND")=>{if(!Array.isArray(t)||0===t.length)return!0;let a=e||"",o="OR"===s?"OR":"AND";return"AND"==o?t.every(e=>a.includes(Fn.textNormalizeForSearch(e))):t.some(e=>a.includes(Fn.textNormalizeForSearch(e)))},$(()=>{$(document).on(Evt.release,".js-propagation",e=>{e.stopPropagation()})}),Fn.shuffle=(e=[],t)=>{var s=t?e:[...e];let a,o;for(a=s.length;1<a;a--)o=Math.floor(Math.random()*a),[s[o],s[a-1]]=[s[a-1],s[o]];return s},Fn.slide={},Fn.slide.is_touch="ontouchstart"in window&&"ontouchend"in window||navigator.msPointerEnabled,Fn.slide.start=Fn.slide.is_touch?"touchstart":"mousedown",Fn.slide.move=Fn.slide.is_touch?"touchmove":"mousemove",Fn.slide.end=Fn.slide.is_touch?"touchend":"mouseup",Fn.slide.leave=Fn.slide.is_touch?"touchleave":"mouseleave",Fn.slide.is_session="sessionStorage"in window&&null!==window.sessionStorage,Fn.slide.storage=(t,e)=>{let s=null;if(Fn.slide.is_session&&void 0!==t)if(void 0!==e)sessionStorage[t]="object"==typeof e?JSON.stringify(e):e;else try{s=new Function("return "+sessionStorage[t])()}catch(e){s=sessionStorage[t]}return s},Fn.slide.storageDel=e=>{sessionStorage.removeItem(e)},Fn.slide.show=(s=".slideshow",e={})=>{let a=$(s),o=$(".slideshow__flex",a),t=$(".slideshow__unit",a),n=$(".js-slide-nav",a),r=$("a",n),l=e.t?$(".js-slide-link",e.t):$(".js-slide-link"),i=e.interval||!1===e.interval?e.interval:3e3,c=e.before,p=e.after,d=e.click,u=e.is_keyboard,h=[],m,g,v,f,j=0,w=e.no||1,_,b,k,y,P,E,S,A,M,F=t.width(),L=(0===F&&setTimeout(()=>{F=t.width()},1),Fn.slide.storage(s)&&(w=Fn.slide.storage(s),Fn.slide.storageDel(s)),$("img",a).attr("draggable","false"),()=>{var e=t.width();c&&c(),0!=e&&(F=e),o.stop().animate({left:F*(w-1)*-1},()=>{p&&p()}),C()}),C=()=>{1<t.length?(a.attr("data-no",w),0<r.length&&(r.removeClass("on"),$('[data-nav="'+w+'"]',a).addClass("on"))):n.remove()},x=e=>{switch(e){case"next":(w+=1)>j&&(w=1);break;case"prev":(w-=1)<1&&(w=j)}},T=()=>{f&&clearTimeout(f),f=setTimeout(()=>{g&&(x("next"),L()),T()},i)};!u&&1!==$(".slideshow").length||document.addEventListener("keydown",e=>{switch(e.key){case"ArrowLeft":i&&T(),x("prev"),L();break;case"ArrowRight":i&&T(),x("next"),L()}return!1}),$(window).on("resize",()=>{F=t.width(),o.css("left",F*(w-1)*-1)}),r.on("click",function(){var e=$(this).attr("data-nav")||"next";return g=!1,"prev"===e||"next"===e?x(e):w=+e,L(),!1}),l.on("click",function(){var e=$(this).attr("data-nav")||"next";return g=!1,"prev"===e||"next"===e?x(e):w=+e,L(),!1});j=t.length,t.each(function(){var e=$(this).attr("data-href");e&&""!=e?h.push(e):h.push(null)}),o.css("left",F*(w-1)*-1),C(),(()=>{let t=()=>{m=!1,v&&clearTimeout(v),v=setTimeout(()=>{!m&&i&&(g=!0)},i)};a.on(Fn.slide.start,e=>{m=!1,g=!1,_=(Fn.slide.is_touch?e.touches[0]:e).pageX,b=(Fn.slide.is_touch?e.touches[0]:e).pageY,k=_,y=b}).on(Fn.slide.end,e=>{S=k-P,A=y-E,m?(Math.abs(A)<50&&(50<S?x("next"):S<-50&&x("prev"),L(),e.preventDefault()),t()):(d&&d(),h[w-1]&&(Fn.slide.storage(s,w),location.href=h[w-1]))}).on(Fn.slide.leave,t).on(Fn.slide.move,e=>{m=!0,P=(Fn.slide.is_touch?e.touches[0]:e).pageX,E=(Fn.slide.is_touch?e.touches[0]:e).pageY,S=k-P,A=y-E,50<Math.abs(S)&&(o.css({left:M-(_-P)}),_=P,e.preventDefault())})})(),i&&(g=!0,T())},"localStorage"in window&&null!==window.localStorage),IS_SESSIONSTORAGE="sessionStorage"in window&&null!==window.sessionStorage,Photos=(Fn.storageLS=(t,e)=>{let s=null;if(IS_LOCALSTORAGE&&void 0!==t)if(void 0!==e)localStorage[t]="object"==typeof e?JSON.stringify(e):e;else try{s=new Function("return "+localStorage[t])()}catch(e){s=localStorage[t]}return s},Fn.storageDelLS=e=>{localStorage.removeItem(e)},Fn.storageSS=(t,e)=>{let s=null;if(IS_SESSIONSTORAGE&&void 0!==t)if(void 0!==e)sessionStorage[t]="object"==typeof e?JSON.stringify(e):e;else try{s=new Function("return "+sessionStorage[t])()}catch(e){s=sessionStorage[t]}return s},Fn.storageDelSS=e=>{sessionStorage.removeItem(e)},Fn.textNormalizeForSearch=(e="")=>"string"!=typeof e?"":e.normalize("NFKC").toLowerCase().replace(/[\u30a1-\u30f6]/g,e=>String.fromCharCode(e.charCodeAt(0)-96)).replace(/ー/g,"").replace(/\s+/g,"").replace(/ゔぁ/g,"ば").replace(/ゔぃ/g,"び").replace(/ゔぇ/g,"べ").replace(/ゔぉ/g,"ぼ").replace(/ゔ/g,"ぶ").replace(/[・,，.．]/g,""),Fn.uploader=()=>{let h={concurrency:3,endpoint:"/assets/api/uploader.php",fadeout_duration:400,max_filesize:5242880,allowed_types:["image/jpeg","image/png","image/gif","image/webp","image/heic","image/heif"],delete_btn_label:"削除",retry_btn_label:"再試行"},o={waiting:"アップロードボタンのクリック待ち",uploading:"アップロード中",done:"アップロード完了しました",error:"エラーが発生しました",403:"セッションが切れました。再読み込みしてください",413:"ファイルサイズが大きすぎます",CSRF_INVALID:"セッションが切れました。再読み込みしてください",METHOD_NOT_ALLOWED:"不正なリクエストです",NO_FILE:"ファイルが選択されていません",TIMEOUT_ERROR:"通信がタイムアウトしました",UPLOAD_ERROR:"アップロードに失敗しました",SERVER_CONNECT_ERROR:"サーバーに接続できませんでした",INVALID_TYPE:"対応していないファイル形式です",FILE_TOO_LARGE:"ファイルサイズが大きすぎます",MOVE_FAILED:"サーバーエラーが発生しました",OTHER:"不正なレスポンスです"},m=(()=>{let n={files:[],activeCount:0},r=(e,t,s="")=>{e.status=t,e.error_code=s,u(e)},t=()=>{};let l=()=>{for(;n.activeCount<h.concurrency;){var e=n.files.find(e=>"waiting"===e.status);if(!e)return;s(e)}},s=s=>{let a=new XMLHttpRequest;var e=new FormData;e.append("image",s.file),e.append("csrf_token",CSRF_TOKEN),r(s,"uploading"),n.activeCount++,a.upload.addEventListener("progress",e=>{e.lengthComputable&&(s.progress=Math.round(e.loaded/e.total*100),u(s))}),a.responseType="json",a.timeout=3e4;let o=()=>{n.activeCount--,i(),l(),t()};a.addEventListener("load",()=>{(()=>{var e=a.response;let t;"success"===e?.status?(s.progress=100,r(s,"done")):(t="error"===e?.status?e.code||"UPLOAD_ERROR":400<=a.status?a.status:"OTHER")&&(s.progress=0,r(s,"error",t)),o()})()}),a.addEventListener("error",()=>{r(s,"error","SERVER_CONNECT_ERROR"),o()}),a.addEventListener("timeout",()=>{r(s,"error","TIMEOUT_ERROR"),o()}),a.open("POST",h.endpoint),a.send(e)},d=t=>{t.el.classList.add("is-fadeout"),setTimeout(()=>{t.preview_url&&URL.revokeObjectURL(t.preview_url),t.el.remove(),n.files=n.files.filter(e=>e!==t)},h.fadeout_duration)},a=e=>"error"===e.status&&e.error_code?o[e.error_code]:o[e.status]||e.status,u=e=>{e.barEl.style.width=e.progress+"%",e.statusEl.textContent=a(e),e.el.className="uploader-filecard is-"+e.status,e.updateButton?.(),"done"===e.status&&d(e)},i=()=>{p.disabled=!n.files.some(e=>"waiting"===e.status)};return{addFiles:(e,{autoStart:t=!1}={})=>{Array.from(e).forEach(e=>{var t={id:crypto.randomUUID(),file:e,status:"waiting",progress:0,error_code:""};switch(0===e.size?(t.status="error",t.error_code="NO_FILE"):0<h.max_filesize&&e.size>h.max_filesize?(t.status="error",t.error_code="FILE_TOO_LARGE"):!h.allowed_types.includes(e.type)&&(e.type.startsWith("image/")||e.name.toLowerCase().endsWith(".heic")||e.name.toLowerCase().endsWith(".heif"))?(t.status="error",t.error_code="INVALID_TYPE"):t.preview_url=URL.createObjectURL(e),!0){case 0===e.size:t.status="error",t.error_code="NO_FILE";break;case 0<h.max_filesize&&e.size>h.max_filesize:t.status="error",t.error_code="FILE_TOO_LARGE";break;default:var s=e.name.toLowerCase();h.allowed_types.includes(e.type)||s.endsWith(".heic")||s.endsWith(".heif")?t.preview_url=URL.createObjectURL(e):(t.status="error",t.error_code="INVALID_TYPE")}n.files.push(t),c.appendChild((e=>{const t=document.createElement("div"),s=document.createElement("div"),a=document.createElement("div"),o=document.createElement("div"),n=document.createElement("img"),r=document.createElement("div"),l=document.createElement("div"),i=document.createElement("div"),c=document.createElement("button"),p=(t.className=`uploader-filecard is-${e.status}`,s.className="uploader-text",a.className="uploader-name",o.className="uploader-thumbnail",r.className="uploader-filecardprogress",l.className="uploader-filecardbar",i.className="uploader-filecardstatus",c.type="button",c.className="uploader-filecardremove",c.textContent=h.delete_btn_label,a.textContent=e.file.name,n.src=e.preview_url,n.onerror=()=>{n.remove();o.classList.add("uploader-nothumbnail");o.onclick=()=>{d(e)}},()=>{if(e.status==="error"){c.textContent=h.retry_btn_label;c.onclick=()=>{e.status="waiting";e.error_code="";u(e);m.processQueue()}}else{c.textContent=h.delete_btn_label;c.onclick=()=>d(e)}});return p(),r.appendChild(l),o.appendChild(n),s.appendChild(a),s.appendChild(r),s.appendChild(i),t.appendChild(o),t.appendChild(s),t.appendChild(c),e.el=t,e.barEl=l,e.statusEl=i,e.updateButton=p,u(e),t})(t))}),i(),t&&l()},processQueue:l}})(),c=document.querySelector(".js-uploader-filelist"),t=document.querySelector(".js-uploader-droparea"),e=document.querySelector(".js-uploader-input"),p=document.querySelector(".js-uploader-button");t.addEventListener("click",()=>e.click()),e.addEventListener("change",e=>{m.addFiles(e.target.files,{autoStart:!1})}),t.addEventListener("dragover",e=>{e.preventDefault(),t.classList.add("is-dragover")}),t.addEventListener("dragleave",()=>{t.classList.remove("is-dragover")}),t.addEventListener("drop",e=>{e.preventDefault(),t.classList.remove("is-dragover"),m.addFiles(e.dataTransfer.files,{autoStart:!0})}),p.addEventListener("click",()=>{m.processQueue()})},{}),getCreateUser=(Photos.likes={},Photos.ls=Fn.storageLS("photowalk")||{},"undefined"==typeof PARAM_EVENT_ID&&(PARAM_EVENT_ID=""),$(()=>{$(".js-page").html(page_init),""!=PARAM_EVENT_ID?$('.js-form-event input[name="id"]').val(PARAM_EVENT_ID):Photos.ls.event_id&&$('.js-form-event input[name="id"]').val(Photos.ls.event_id)}),document.addEventListener("contextmenu",async e=>{await(await fetch("/assets/api/csrf_token_for_img.php")).json()}),$(()=>{$(document).on("submit",".js-form-event",function(){let e=$(this),s=$(".js-form-error",e),t=$('[name="id"]',e),a=t.val();return s.html("").css({visibility:"hidden"}),(async()=>{try{var e=await getEventInfoWithImages(a),t=new URLSearchParams(window.location.search);if("success"!=e.status)return!s.html(e.message).css({visibility:"visible"});Photos.event_id=a,Photos.photowalkers=e.photowalkers,Photos.ls.event_id=a,Fn.storageLS("photowalk",Photos.ls),t.set("event_id",a),history.replaceState(null,"","?"+t.toString()),$(".js-page").html(page_account).hide(),$(".js-account-title .ja").text(e.title_ja),$(".js-account-title .en").text(e.title_en),$(".js-account-time").text(e.date),$(".js-account-excerpt .ja").text(e.excerpt_ja),$(".js-account-excerpt .en").text(e.excerpt_en),$(".js-page").show(),Photos.ls.uid&&$('.js-form-account input[name="display_name"]').val(Photos.ls.uid)}catch(e){return!$(".js-page").html(page_error)}})(),!1}),$(document).on("click",".js-account-firsttime",()=>{$('.js-account[data-flow="1"]').hide(),$('.js-account[data-flow="2-1"]').show()}),$(document).on("click",".js-account-returning",()=>{$('.js-account[data-flow="1"]').hide(),$('.js-account[data-flow="2-2"]').show()}),$(document).on("click",".js-link-account",()=>{$(".js-account").hide(),$('.js-account[data-flow="1"]').show()}),$(document).on("click",".js-account-create",function(){$(this).replaceWith(`
      <button class="js-account-create-number">
        <span class="animation-blinker" style="font-size:14px;">
          <span class="ja">作成中...</span>
          <span class="en">Creating...</span>
        </span>
      </button>
    `),(async()=>{try{var e=await getCreateUser();if("success"!=e.status)return!$(".js-page").html(page_error);Photos.handle=e.uid,Photos.ls.uid=e.uid,Fn.storageLS("photowalk",Photos.ls),$(".js-account-create-number").replaceWith(`
          <p><strong>${e.uid}</strong></p>
          <p><button class="js-account-next" style="width:5em;">OK</button></p>
        `),$('.js-account[data-flow="1"]').hide(),$('.js-account[data-flow="2-1"]').show()}catch(e){return!$(".js-page").html(page_error)}})()}),Photos.showList=()=>{var e=Photos.is_list_fixed?Photos.photowalkers:Fn.shuffle(Photos.photowalkers,!0);let t="",s,a;for(Photos.is_list_fixed=!1,$(".js-page").html(page_list).hide(),s=0;s<e.length;s++){var o=e[s];t+=`
        <li>
          <a class="js-link-photowalker" data-name="${o.name}"><span>${o.name}</span></a>
        </li>
      `}if($(".js-photowalkers-list").html(t),Photos.likes)for(a in Photos.likes){var n=$(`.js-link-photowalker[data-name="${a}"]`).closest("li");n.addClass("selected"),$(".js-photowalkers-list").append(n)}$(".js-page").show()},$(document).on("click",".js-account-next",Photos.showList),$(document).on("submit",".js-form-account",function(){let e=$(this),t=$(".js-form-error",e),s=$('[name="display_name"]',e),a=s.val();return t.css({visibility:"hidden"}),(async()=>{try{var e=await getUser(a);if("success"!=e.status)return!t.html(e.message).css({visibility:"visible"});Photos.handle=e.user.handle,e.likes.forEach(e=>{var t=e.photowalker;Photos.likes[t]||(Photos.likes[t]=[]),Photos.likes[t].push(e.filename)}),Photos.showList(),Photos.ls.uid=e.user.handle,Fn.storageLS("photowalk",Photos.ls)}catch(e){return!$(".js-page").html(page_error)}})(),!1}),$(document).on("click",".js-link-photowalker",function(){let t=$(this).attr("data-name"),e=Photos.photowalkers.find(e=>e.name===t)?.images||[],s=Fn.shuffle(e),a="",o;for($(".js-page").html(page_photos).hide(),o=0;o<s.length;o++)a+=`<li data-filename="${s[o]}"><img src="./assets/photo.php?filename=${Photos.event_id}/${t}/${s[o]}" loading="lazy"></li>`;if($(".js-photos-list").html(a),Photos.selected_photowaker=t,Photos.likes&&Photos.likes[t]){for(o=0;o<Photos.likes[t].length;o++)$(`.js-photos-list li[data-filename="${Photos.likes[t][o]}"]`).addClass("selected");$(".js-photos-selected-num").html($(".js-photos-list li.selected").length)}0===$(".js-photos-list li.selected").length&&$(".js-photos-selected, .js-photos-submit").css({opacity:.3}),$(".js-page").show()}),$(document).on("click",".js-photos-list li",function(){var e=$(this),e=(e.hasClass("selected")?(e.addClass("temp"),e.removeClass("selected")):(e.removeClass("temp"),e.addClass("selected")),$(".js-photos-list li.selected").length),t=$(".js-photos-selected, .js-photos-submit");$(".js-photos-selected-num").html(e),0<e?t.css({opacity:1}):t.css({opacity:.3})}),$(document).on("click",".js-photos-layout",function(){var e="one"===$(".js-photos-list").attr("data-layout")?"column":"one";$(".js-photos-list").attr("data-layout",e)}),$(document).on("click",".js-photos-bg",()=>{var e=$(".js-photos"),t="white"===e.attr("data-bg")?"black":"white";e.attr("data-bg",t)}),$(document).on("click",".js-photos-selected",()=>{if(0===$(".js-photos-list li.selected").length)return!1;5<$(".js-photos-list li.selected").length?$(".js-photos-list-excerpt").addClass("show"):$(".js-photos-list-excerpt").removeClass("show"),$(".js-photos-list li.temp").removeClass("temp"),$(".js-photos").attr("data-type","submit"),window.scrollTo(0,1)}),$(document).on("submit",".js-form-submit",()=>(0!==$(".js-photos-list li.selected").length&&(5<$(".js-photos-list li.selected").length?($(".js-photos-toast").addClass("show").on("click",function(){$(this).removeClass("show")}),setTimeout(()=>{$(".js-photos-toast").removeClass("show")},3e3)):(async()=>{let e={};e.event_id=Photos.event_id,e.uid=Photos.handle,e.photowalker=Photos.selected_photowaker,e.images=[],$(".js-photos-list li.selected").each(function(){e.images.push($(this).attr("data-filename"))}),$(".js-page").html(page_loading);try{var t=await setLikes(e);if("success"!=t.status)return $(".js-page").html(page_error).hide(),$(".js-error").html(t.message),!$(".js-page").show();Photos.likes[e.photowalker]=e.images,$(".js-page").html(page_complete)}catch(e){return $(".js-page").html(page_error),!console.error("error",e)}})()),!1)),$(document).on("click",".js-photos-back",()=>{switch($(".js-photos").attr("data-type")){case"confirm":Photos.is_list_fixed=!0,Photos.showList();break;case"submit":$(".js-photos").attr("data-type","confirm"),$(".js-photos-list li").removeClass("temp")}}),$(document).on("click",".js-link-complete",Photos.showList)}),()=>$.ajax({url:"./assets/api/create_user.php",method:"POST",dataType:"json",data:{csrf_token:CSRF_TOKEN}})),getEventInfo=(e="")=>$.ajax({url:"./assets/api/event_info_db_only.php",method:"POST",dataType:"json",data:{event_id:e,csrf_token:CSRF_TOKEN}}),getEventInfoWithImages=(e="")=>$.ajax({url:"./assets/api/event_info.php",method:"POST",dataType:"json",data:{event_id:e,csrf_token:CSRF_TOKEN}}),getUser=(e="")=>$.ajax({url:"./assets/api/get_user.php",method:"POST",dataType:"json",data:{uid:e,event_id:Photos.event_id,csrf_token:CSRF_TOKEN}}),page_loading=`
<div class="flex-center">
  <span class="animation-blinker">loading...</span>
</div>
`,page_error=`
<div class="flex-center">
  <div class="error">
    <p class="js-error">
      <span class="ja">想定外のエラーが発生しました。<br>時間を置いてもう一度お試しください。</span>
      <span class="en">Something went wrong.<br>Please try again in a little while.</span>
    </p>
    <p><a href="/">はじめに戻る</a></p>
  </div>
</div>
`,page_init=`
<section class="flex-center">
  <div class="init">
    <h1>
      <span class="ja">自薦＆他薦で決める一枚</span>
      <span class="en">Chosen — By You, By Them</span>
    </h1>
    <div class="init-excerpt">
      <div class="ja">
        <p>「誰が」「どの写真」を選んだか分からないから、完全に自分視点になれるのがイイ！</p>
        <p>さっそくイベントIDを入力してはじめましょう！</p>
      </div>
      <div class="en">
        <p>Because you don’t know who chose which photo, you can fully experience it from your own perspective — and that’s what makes it great!</p>
        <p>Enter the Event ID and get started right away!</p>
      </div>
    </div>
    <form class="js-form-event">
      <div>
        <input type="text" name="id" value="">
        <button type="submit">
          <span class="ja">スタート</span>
          <span class="en">START</span>
        </button>
      </div>
      <p class="form-error js-form-error" style="visibility:hidden;"></p>
    </form>
  </div>
</section>
`,page_account=`
<section class="flex-center">
  <section class="account js-account" data-flow="1">
    <p class="bar2">
      <a class="bar2-link-back" onclick="location.href='./';">
        <span class="ja">終了する</span>
        <span class="en">End</span>
      </a>
    </p>
    <hgroup>
      <h2 class="js-account-title"><span class="ja"></span><span class="en"></span></h2>
      <p class="js-account-time"></p>
    </hgroup>
    <div class="account-excerpt">
      <p class="js-account-excerpt" style="margin-bottom:10px;"><span class="ja"></span><span class="en"></span></p>

      <div class="ja">
        <p>選出方法ですが、自薦＆他薦で選出します。<br>フォトウォーカーごとに「おっ！」となった写真を選んで、一人ずつの一枚を決めましょう！</p>
        <p>ユーザーIDはありますか？</p>
      </div>
      <div class="en">
        <p>For the selection method, we’ll accept both self-nominations and nominations by others.<br>For each photowalker, choose the photos that really catch your eye (“Wow!” photos) and decide on one photo per person.</p>
        <p>Do you have your USER ID?</p>
      </div>
    </div>
    <div class="flex-button">
      <button type="button" class="js-account-firsttime">
        <span class="ja">はじめて</span>
        <span class="en">First Time</span>
      </button>
      <button type="button" class="js-account-returning">
        <span class="ja">あります！</span>
        <span class="en">Returning</span>
      </button>
    </div>
  </section>

  <section class="account js-account" data-flow="2-1" style="display:none;">
    <p class="bar2">
      <a class="bar2-link-back js-link-account">
        <span class="ja">戻る</span>
        <span class="en">Back</span>
      </a>
    </p>
    <p>
      <span class="ja">あなたのユーザーIDを作成します。<br>再発行はできませんので、作成後はキャプチャ撮るとかどこかにメモしておいてくださいね。</span>
      <span class="en">We will create your USER ID.<br>It cannot be reissued, so please take a screenshot or note it down somewhere after it’s created.</span>
    </p>
    <p>
      <button type="button" class="js-account-create">
        <span class="ja">作成する</span>
        <span class="en">Create</span>
      </button>
    </p>
  </section>

  <section class="account js-account" data-flow="2-2" style="display:none;">
    <p class="bar2">
      <a class="bar2-link-back js-link-account">
        <span class="ja">戻る</span>
        <span class="en">Back</span>
      </a>
    </p>
    <form class="js-form-account">
      <h2>
        <span class="ja">ユーザーID</span>
        <span class="en">USER ID</span>
      </h2>
      <div>
        <input type="text" name="display_name" value="">
        <button type="submit">
          <span class="ja">写真を見る</span>
          <span class="en">View Photos</span>
        </button>
      </div>
      <p class="form-error js-form-error" style="visibility:hidden;margin-bottom:10px;">
        <span class="ja">ユーザーIDが一致しません。<br>ID名を確かめてください。</span>
        <span class="en">The USER ID does not match. Please check the ID name.</span>
      </p>
    </form>
  </section>
</section>
`,page_list=`
<section class="flex-center">
  <p class="bar2">
    <a class="bar2-link-back" onclick="location.href='./';">
      <span class="ja">終了する</span>
      <span class="en">End</span>
    </a>
  </p>
  <div class="list">
    <h2>
      <span class="ja">フォトウォーカー</span>
      <span class="en">Photowalkers</span>
    </h2>
    <ul class="js-photowalkers-list"></ul>
    <p class="ja">ランダム未投票順</p>
  </div>
</section>
`,page_photos=`
<section class="photos js-photos" data-type="confirm" data-bg="white">
  <nav class="bar bar--top">
    <button type="button" class="icon-back js-photos-back"><span></span></button>
    <div>
      <button type="button" class="js-photos-layout">
        <span class="icon-column-and-one">
          <span class="icon-column">
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
          </span>
          <span class="icon-one">
            <span></span>
          </span>
        </span>
      </button>
      <button type="button" class="icon-bg js-photos-bg">
        <span class="icon-bg-inner">
          <span></span>
          <span></span>
        </span>
      </button>
    </div>
  </nav>
  <div class="photos-inner">
    <p class="photos-list-excerpt" data-type="confirm">
      <span class="ja">まずは「おっ！」となった写真をタップしてください。<br>右上のアイコンで表示切り替えもできます。</span>
      <span class="en">Choose the photo that caught your eye.</span>
    </p>
    <p class="photos-list-excerpt js-photos-list-excerpt" data-type="submit">
      <span class="ja">続いて、5枚に絞り込んでから投票してください。</span>
      <span class="en">If there are more than five images, please limit them to five.</span>
    </p>
    <ul class="photos-list js-photos-list" data-layout="column" data-bg="white"></ul>
  </div>
  <nav class="bar bar--bottom-confirm">
    <button type="button" class="photos-selected js-photos-selected">
      <span class="ja">選択した画像を確認する »</span>
      <span class="en">Check Selected Image(s) »</span>
    </button>
  </nav>
  <nav class="bar bar--bottom-submit">
    <span>
      <span class="js-photos-selected-num">0</span> / 5
    </span>
    <form class="js-form-submit">
      <button type="submit" class="photos-selected js-photos-submit">
        <span class="ja">投票する</span>
        <span class="en">Vote</span>
      </button>
    </form>
  </nav>

  <div class="photos-toast js-photos-toast">5枚まで!!</div>
</section>
`,page_complete=`
<section class="flex-center">
  <div class="complete">
    <p>
      <span class="ja">ありがとうございます！<br>投票を受け付けました。</span>
      <span class="en">Thank you!</span>
    </p>
    <p>
      <button type="button" class="js-link-complete">
        <span class="ja">リストに戻る</span>
        <span class="en">Back to List</span>
      </button>
    </p>
  </div>
</section>
`,setEventInfo=e=>(e.append("csrf_token",CSRF_TOKEN),$.ajax({url:"./assets/api/set_event_info.php",method:"POST",dataType:"json",data:e,processData:!1,contentType:!1})),setLikes=(e={})=>(e.csrf_token=CSRF_TOKEN,$.ajax({url:"./assets/api/likes.php",method:"POST",dataType:"json",data:e}));